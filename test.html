<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProjectX Framework Test</title>
    <meta name="description" content="Test page for ProjectX framework functionality">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            border: 1px solid #e1e1e1;
            border-radius: 4px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #1473e6;
            padding-bottom: 0.5rem;
        }
        
        .status {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin: 0.5rem 0;
            font-weight: bold;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .auto-block-demo {
            margin: 1rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-left: 4px solid #1473e6;
        }
        
        .cards-demo ul {
            list-style: none;
            padding: 0;
        }
        
        .cards-demo li {
            margin: 1rem 0;
            padding: 1rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .columns-demo {
            display: flex;
            gap: 1rem;
        }
        
        .columns-demo > div {
            flex: 1;
            padding: 1rem;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .button {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: #1473e6;
            color: white;
            text-decoration: none;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        
        .button.primary {
            background: #0d47a1;
        }
        
        .button.secondary {
            background: #6c757d;
        }
        
        .icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ProjectX Framework Test Page</h1>
        <p>This page tests the ProjectX framework functionality and auto-blocking capabilities.</p>
        
        <div id="test-results">
            <div class="status info">Loading ProjectX framework...</div>
        </div>
        
        <div class="test-section">
            <h2>1. Hero Auto-blocking Test</h2>
            <div class="auto-block-demo">
                <h1>Welcome to ProjectX</h1>
                <picture>
                    <img src="https://via.placeholder.com/800x400/1473e6/ffffff?text=Hero+Image" 
                         alt="Hero Image" 
                         style="width: 100%; height: auto; border-radius: 4px;">
                </picture>
                <p>This H1 + Picture combination should be auto-blocked as a hero.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>2. Cards Auto-blocking Test</h2>
            <div class="auto-block-demo cards-demo">
                <ul>
                    <li>
                        <img src="https://via.placeholder.com/200x150/28a745/ffffff?text=Card+1" 
                             alt="Card 1" style="width: 200px; height: 150px; float: left; margin-right: 1rem;">
                        <h3>Feature One</h3>
                        <p>This is the first feature card with an image and text content.</p>
                    </li>
                    <li>
                        <img src="https://via.placeholder.com/200x150/dc3545/ffffff?text=Card+2" 
                             alt="Card 2" style="width: 200px; height: 150px; float: left; margin-right: 1rem;">
                        <h3>Feature Two</h3>
                        <p>This is the second feature card with an image and text content.</p>
                    </li>
                    <li>
                        <img src="https://via.placeholder.com/200x150/ffc107/ffffff?text=Card+3" 
                             alt="Card 3" style="width: 200px; height: 150px; float: left; margin-right: 1rem;">
                        <h3>Feature Three</h3>
                        <p>This is the third feature card with an image and text content.</p>
                    </li>
                </ul>
                <p style="clear: both;">This list with images should be auto-blocked as cards.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>3. Columns Auto-blocking Test</h2>
            <div class="auto-block-demo">
                <div class="columns-demo">
                    <div>
                        <h3>Column One</h3>
                        <p>This is the first column with substantial content that should be detected by the auto-blocking system.</p>
                        <p>Additional content to ensure it meets the threshold for auto-blocking.</p>
                    </div>
                    <div>
                        <h3>Column Two</h3>
                        <p>This is the second column with substantial content that should be detected by the auto-blocking system.</p>
                        <p>Additional content to ensure it meets the threshold for auto-blocking.</p>
                    </div>
                </div>
                <p>This side-by-side content should be auto-blocked as columns.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>4. Button Decoration Test</h2>
            <div class="auto-block-demo">
                <p><a href="#test">Regular Link Button</a></p>
                <p><strong><a href="#test">Primary Button</a></strong></p>
                <p><em><a href="#test">Secondary Button</a></em></p>
                <p>These links should be automatically decorated as buttons.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>5. Icon Decoration Test</h2>
            <div class="auto-block-demo">
                <p><span class="icon icon-search"></span>Search functionality</p>
                <p><span class="icon icon-user"></span>User profile</p>
                <p><span class="icon icon-settings"></span>Settings panel</p>
                <p>These icon spans should be automatically decorated with images.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>6. Table Auto-blocking Test</h2>
            <div class="auto-block-demo">
                <table border="1" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th style="padding: 0.5rem;">Feature</th>
                            <th style="padding: 0.5rem;">EDS</th>
                            <th style="padding: 0.5rem;">ProjectX</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 0.5rem;">Bundle Size</td>
                            <td style="padding: 0.5rem;">230KB</td>
                            <td style="padding: 0.5rem;">45KB</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">RUM Tracking</td>
                            <td style="padding: 0.5rem;">Yes</td>
                            <td style="padding: 0.5rem;">No</td>
                        </tr>
                        <tr>
                            <td style="padding: 0.5rem;">Auto-blocking</td>
                            <td style="padding: 0.5rem;">Basic</td>
                            <td style="padding: 0.5rem;">Enhanced</td>
                        </tr>
                    </tbody>
                </table>
                <p>This table should be auto-blocked as a table block.</p>
            </div>
        </div>
        
        <div class="test-section">
            <h2>7. Proxy System Test</h2>
            <div id="proxy-status">
                <div class="status info">Testing proxy system compatibility...</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>8. Framework Status</h2>
            <div id="framework-status">
                <div class="status info">Checking framework status...</div>
            </div>
        </div>
    </div>

    <!-- Testing ProjectX via enhanced proxy system -->
    <script type="module" src="/scripts/scripts.js"></script>
    <!-- Alternative: Direct ProjectX import -->
    <!-- <script type="module" src="/scripts/projectX.js"></script> -->
    
    <script type="module">
        // Test ProjectX functionality
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                runProjectXTests();
            }, 1000); // Give ProjectX time to initialize
        });
        
        function runProjectXTests() {
            const results = [];
            const testResults = document.getElementById('test-results');
            const frameworkStatus = document.getElementById('framework-status');
            
            // Test 1: Framework initialization
            try {
                const hlxExists = typeof window.hlx !== 'undefined';
                results.push({
                    test: 'Framework Initialization',
                    passed: hlxExists,
                    message: hlxExists ? 'window.hlx object created' : 'window.hlx object missing'
                });
            } catch (error) {
                results.push({
                    test: 'Framework Initialization',
                    passed: false,
                    message: `Error: ${error.message}`
                });
            }
            
            // Test 2: Core functions availability
            const coreFunctions = [
                'toClassName', 'toCamelCase', 'readBlockConfig', 
                'loadCSS', 'createOptimizedPicture', 'getMetadata',
                'buildBlock', 'decorateBlock', 'loadBlock'
            ];
            
            const missingFunctions = coreFunctions.filter(fn => typeof window[fn] === 'undefined');
            results.push({
                test: 'Core Functions Available',
                passed: missingFunctions.length === 0,
                message: missingFunctions.length === 0 
                    ? 'All core functions available' 
                    : `Missing functions: ${missingFunctions.join(', ')}`
            });
            
            // Test 3: Auto-blocking detection
            const autoBlockedElements = document.querySelectorAll('[data-auto-blocked="true"]');
            results.push({
                test: 'Auto-blocking Active',
                passed: autoBlockedElements.length > 0,
                message: `${autoBlockedElements.length} elements auto-blocked`
            });
            
            // Test 4: Block decoration
            const blocks = document.querySelectorAll('.block');
            results.push({
                test: 'Block Decoration',
                passed: blocks.length > 0,
                message: `${blocks.length} blocks decorated`
            });
            
            // Test 5: Button decoration
            const buttons = document.querySelectorAll('.button');
            results.push({
                test: 'Button Decoration',
                passed: buttons.length > 0,
                message: `${buttons.length} buttons decorated`
            });
            
            // Test 6: Proxy system functionality
            const proxyTests = [];
            
            // Test CMS Plus integration
            const cmsPlusExists = typeof window.cmsplus !== 'undefined' && typeof window.cmsplus.debug === 'function';
            proxyTests.push({
                name: 'CMS Plus Integration',
                passed: cmsPlusExists,
                message: cmsPlusExists ? 'window.cmsplus.debug available' : 'CMS Plus integration missing'
            });
            
            // Test plugin context availability
            const pluginContextExists = typeof window.pluginContext !== 'undefined' || 
                                      document.querySelector('script[src*="scripts.js"]') !== null;
            proxyTests.push({
                name: 'Plugin Context',
                passed: pluginContextExists,
                message: pluginContextExists ? 'Plugin system active' : 'Plugin system not detected'
            });
            
            // Test enhanced proxy loading
            const scriptSrc = document.querySelector('script[src*="/scripts/"]')?.src || '';
            const usingProxy = scriptSrc.includes('scripts.js');
            proxyTests.push({
                name: 'Proxy System Active',
                passed: usingProxy,
                message: usingProxy ? 'Using enhanced scripts.js proxy' : 'Using direct projectX.js'
            });
            
            // Display proxy test results
            const proxyStatus = document.getElementById('proxy-status');
            proxyStatus.innerHTML = '';
            proxyTests.forEach(test => {
                const div = document.createElement('div');
                div.className = `status ${test.passed ? 'success' : 'info'}`;
                div.innerHTML = `
                    <strong>${test.name}:</strong> 
                    ${test.passed ? '✅ ACTIVE' : 'ℹ️ INFO'} - 
                    ${test.message}
                `;
                proxyStatus.appendChild(div);
            });
            
            // Display results
            testResults.innerHTML = '';
            results.forEach(result => {
                const div = document.createElement('div');
                div.className = `status ${result.passed ? 'success' : 'error'}`;
                div.innerHTML = `
                    <strong>${result.test}:</strong> 
                    ${result.passed ? '✅ PASS' : '❌ FAIL'} - 
                    ${result.message}
                `;
                testResults.appendChild(div);
            });
            
            // Framework status
            const passedTests = results.filter(r => r.passed).length;
            const totalTests = results.length;
            const statusDiv = document.createElement('div');
            statusDiv.className = `status ${passedTests === totalTests ? 'success' : 'error'}`;
            statusDiv.innerHTML = `
                <strong>Overall Status:</strong> 
                ${passedTests}/${totalTests} tests passed
                ${passedTests === totalTests ? ' - ProjectX is working correctly!' : ' - Some issues detected'}
            `;
            frameworkStatus.innerHTML = '';
            frameworkStatus.appendChild(statusDiv);
            
            // Debug information
            if (window.projectX && window.projectX.debug) {
                console.log('ProjectX Test Results:', results);
                console.log('Auto-blocked elements:', autoBlockedElements);
                console.log('Decorated blocks:', blocks);
                console.log('Decorated buttons:', buttons);
            }
        }
    </script>
</body>
</html>